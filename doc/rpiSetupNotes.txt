Raspberry Pi Setup for Illumicone - 6/22/2017

These notes are not from the original setup done in 2016.  Rather, they are
notes that I'm writing as I set up another Raspberry Pi to run widgetRcvr for widget
firmware development.


Use raspi-config to enable SPI on boot
--------------------------------------
sudo raspi-config 
advanced options
A6 SPI
enable
load kernel module automatically or whatever
save and reboot


Use the static IP address 192.168.69.102
----------------------------------------

At some point in the past, the only modifications needed were to
/etc/network/interfaces:

    auto eth0
    iface eth0 inet static
        address 192.168.69.102
        netmask 255.255.255.0
        gateway 192.168.69.1

At present, even with that change to interfaces, dhcpd5 will still use DHCP to
get a second address for eth0.  To stop that from happening, the static
address must be configured in /etc/dhcpcd.conf (note the extra "c" in the file
name) by adding this:

    # Use a static IP address on the Illumicone network.
    interface eth0
        static ip_address=192.168.69.102/24
        static routers=192.168.69.1
        static domain_name_servers=192.168.69.1 8.8.8.8

(At least we're not having to deal with fucking connman.)


Install git-flow, clone the Illumicone project, init git flow, pull current feature
-----------------------------------------------------------------------------------
sudo apt-get install git-flow
cd ~/devl
git clone https://github.com/skipzone/Illumicone.git
cd Illumicone/
git flow init
git flow feature pull origin ContortOMatic


Install RF24
------------
Use tmrh20's fork of RF24.  This is the same one we use for the widget Arduinos.
cd ~/devl
git clone https://github.com/nRF24/RF24.git
sudo make install -B


================================================================================


9/13/2017 -- Set up ic-widpatcon on a Raspberry Pi 3 B using Raspbian Stretch

0.  Write the image to a micro-SD card.

    diskutil list
    diskutil unmountDisk /dev/diskN
    sudo dd bs=1m if=2017-09-07-raspbian-stretch-lite.img of=/dev/rdiskN
    diskutil unmountDisk /dev/diskN

    It appears that the file system will be expanded automatically upon first
    boot.


1.  Create a file named ssh on the boot partition.

    The easiest way is to boot the RPi with an HDMI monitor connected.  User is
    pi, password is raspberry.  Otherwise, use a Linux VM to access the boot
    partition and create the file.
    
    sudo touch /boot/ssh
    sudo reboot


2.  Update everything.

    sudo apt-get update
    sudo apt-get upgrade


3.  Create user illumicone and add it to the sudo group.

    sudo adduser illumicone
    sudo adduser illumicone sudo


4.  Change user pi's password to be the same as illumicone's.

    passwd


5.  Set up ssh keys.

    on development system:  scp ~/.ssh/id_rsa.pub illumicone@raspberrypi.local:myrsa.pub

    mkdir .ssh
    cd .ssh
    ssh-keygen
    mv ../myrsa.pub authorized_keys
    chmod 600 authorized_keys


6.  Use raspi-config to change the host name to ic-widpatcon.

    sudo raspi-config 
    Follow the bouncing ball.


7.  Use raspi-config to enable SPI on boot

    sudo raspi-config 
        5 Interfacing Options
        P4 SPI
        enable


8.  Create .bash_aliases

    on development system:  scp ~/devl/Illumicone/sbin/bash_aliases illumicone@ic-widpatcon.local:.bash_aliases


9.  Install required and useful packages.

    sudo apt-get install vim psmisc git git-flow

    (psmisc gives us the killall utility.)


10.  Install RF24

    Use tmrh20's fork of RF24.  This is the same one we use for the widget Arduinos.

    mkdir devl
    cd devl
    git clone https://github.com/nRF24/RF24.git
    cd RF24
    sudo make install -B


11.  Set up the Illumicone project.

    cd ~/devl
    git clone https://github.com/skipzone/Illumicone
    cd Illumicone
    git flow init
    cd src
    make
    make widgetRcvr
    cd ../config
    ln -s someConfig.json activeConfig.json
    git config --global core.editor "vim"

12.  Set up Wi-Fi to access the development network.

    To see what networks are visible:
        sudo iwlist wlan0 scan

    Add this to /etc/wpa_supplicant/wpa_supplicant.conf:
        network={
                ssid="thessid"
                psk="thepassword"
        }

    Use ifconfig to see if the connection was successful.

    wpa-supplicant should notice the change.  If it doesn't, try this:
        sudo wpa_cli reconfigure
    If that doesn't work, reboot.

    Another way to do this is to use the wpa_passphrase utility:
        wpa_passphrase "thessid" "thepassword" | sudo tee -a /etc/wpa_supplicant/wpa_supplicant.conf > /dev/null
    Then, edit wpa_supplicant.conf and removed the commented-out password.

    This might help with hidden networks:
        scan_ssid=1

    Add this when configuring multiple networks:
        priority=1
        id_str="networkOne"
        ...
        priority=2
        id_str="networkTwo"

    For unsecured networks, use this instead of psk:
        key_mgmt=NONE


x.  Assign the static IP address for ic-widpatcon.


x.  Set up time zone, NTP, RTC, and NTP server.


x.  Set up illumicone's crontab.



